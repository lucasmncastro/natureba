pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- todo
-- x start from 2nd view
-- x title
-- - env:
-- -  x home
-- -  x mother
-- -  x rock
-- -  x frog
-- -  x fisher
-- -  x flower
-- -  - bird
-- -  - camaleao
-- -  x sand
-- x sfx block
-- - start event on hit
-- - music
-- - transform:
-- - - bird
-- - - frog
-- - - cameleao
-- - add goal!

function _init()
 x=23
 y=5
 f=false
 s=1
 sp=1
 t=0
 tic=0
 
 -- 0 - title
 -- 1 - running 
 state=0
 title="power you"
 lives=0
end

function _update()
 update_utils()
 if state==0 then
  update_title()
 end
 if state==1 then
  update_game()
 end
 update_camera()
end

function update_game()
 if btnp(⬆️) then
 	ny-=1
 end
 if btnp(⬇️) then
 	ny+=1
 end
 if btnp(➡️) then
 	nx+=1
  f=false
 end
 if btnp(⬅️) then
 	nx-=1
 	f=true
 end
 if btnp(⬅️) or btnp(➡️) or
  btnp(⬆️) or btnp(⬇️) then
  msg=nil
 end

 -- block
 cell=mget(nx,ny)
 if fget(cell,0) then
  nx=x
  ny=y
  sfx(0)
 end
 
 -- when hit flag 3
 -- trigger event.
 if fget(cell,3) then
  trigger(cell,nx,ny)
 end
 
 -- limits
 if nx<0 then
  nx=x
 end
 if ny<0 then
  ny=y
 end
 x=nx
 y=ny
end

function trigger(i,_x,_y)
 local mom={4,5}
 if del(mom,i) then
  show_text("go safe, son...\ni'm waiting for you.")
 end 
end

function show_text(_txt)
 msg=_txt
end

function _draw()
	cls(0)

	camera(cx,cy) 
	map()
	spr(sp,x*8,y*8,1,1,f)

 if state==0 then
  rectfill(cx,cy+54,cx+128,cy+79,7)
 	print(title,cx+60-#title*2,cy+60,0)
  start_title="press ❎ to start"
  print(start_title,cx+60-#start_title*2,cy+70,6)
 end

 if cell then
  --print(cell,cx,cy,11)
 end

 -- status bar
 if state!=0 then
	 for i=0,lives-1 do
	  spr(3,cx+8*i,cy)
	 end
 end
 
 if msg then
  rectfill(cx,cy+56,cx+128,cy+75,7)
 	print(msg,cx+2,cy+60,0)
 end
end
-->8
-- utils

function update_title()
 if btnp(❎) then
  state=1
 end
end

function update_camera()
	cx=(x*8\128)*128
	cy=(y*8\128)*128
end

function update_utils()
 nx=x
 ny=y

 t+=1
 if t%10==0 then
  tic+=1
  if tic==2 then
   tic=0
  end  
  change_sprites()
 end
end

function change_sprites()
 for ix=0,127 do
  for iy=0,127 do
   local ic = mget(ix+1,iy)
   if tic==1 then
	   if fget(ic,2) then
	    mset(ix+1,iy,ic-1)
	   end
	  else
	   if fget(ic,1) then
	    mset(ix+1,iy,ic+1)
	   end
	  end
  end
 end
end
__gfx__
000000000000000000000000000000000000eee00000eee000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000eeeee000eeeee00000000000000044400000000000000000000000000000000000000000000000000000000000000
007007000009990000000000000808000000e0ee0000e0ee00000000000000400044000000000000000000000000000000000000000000000000000000000000
00077000009999900000000000888080000eeeee000eeeee00000000000044044400400000000000000000000000000000000000000000000000000000000000
0007700000999990000000000088888000eee0ee00eeeeee00000000004400444444040000000000000000000000000000000000000000000000000000000000
00700700009909000000000000088800000eeeee000eeeee00000000440044444444404400000000000000000000000000000000000000000000000000000000
00000000009999900000000000008000000eeeee000eeeee00000000004444444444440000000000000000000000000000000000000000000000000000000000
00000000009009000000000000000000000e000e000e000e00000000004444444404440000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000004444444000440000000000000000000000000000000000000000000000000000000000
00000000000000000000b00000000000000000000000000000000000004444444000440000000000000000000000000000000000000000000000000000000000
000000000000b000000bbb0000000000000000000000000000000000044444444000444000000000000000000000000000000000000000000000000000000000
000000000000b000000bbb0000000000000000000000000000555550000000000444000000000000000000000000000000000000000000000000000000000000
00000000000bbb0000bbbbb000300000000300000055550005555505000000000000000000000000000000000000000000000000000000000000000000000000
00090000000bbb0000bbbbb000030000000300000555505005555055000000044440000000000000000000000000000000000000000000000000000000000000
0090900000bbbbb00bbbbbbb00000000000000000555555005555555000000000000000000000000000000000000000000000000000000000000000000000000
000900000000b0000000b00000000000000000000555555005555555000000000000000000000000000000000000000000000000000000000000000000000000
0e000000cccccccccccccccccccccc00000200000002000000ffffffffffff000000000000000000000000000000000000000000000000000000000000000000
e0e00000ccccccccccccccccccccccc000222000002220000ffffffffffffff00000000000000000000000000000000000000000000000000000000000000000
0e000090cccccccccccccccccccccccc0022220220222200ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000909ccc0cccccccc0ccccccccccc0220202002202020ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000090cc0c0cccccc0c0cccccccccc2022222002222220ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00f00000cccccccccccccccccccccccc0222222002222202ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
0f0f0000cccccccccccccccccccccccc0020200000202000ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00f00000cccccccccccccccccccccccc0020200000202000ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
0000000000cccccccccccccccccccccc0000000000000300ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
000000000ccccccccccccccccccccccc0000000000003030ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000cccccccccccccccccccccccc0000000000033330ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
000e0000cccccccccccccccccccccccc0000000000333300ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00e0e000cccccccccccccccccccccccc0333333000330030ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
000e0000cccccccccccccccccccccccc3333330300300000ffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc0cccccccccccccc003333330030000000fffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc00cccccccccccc00003000300300000000ffffffffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000707077000000000070707700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007070700700000000707070070000000007070770000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00070707777700000007070777770000000070707007000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707070000000000070707000000000000707077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00707070700700000070707070070000007070700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070700007770000707070000777000007070707007000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700077000000070070007700000070707000077700000000000000000000000000000000000000000000000000000000000000000000000000000000000
07077077777000000707707777700000007007000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07070077777770000707007777777000070770777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000000000000070000000000000070700777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077777707000000007777770700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007077777700000000707777770000000070777070000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00007000000000000000700000000000000070000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000077777770000000007777770000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000070000000000000000000070000000000707000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
000000000b0d0001010000000000000000010102040101010100000000000000000305010305000000000000000000000001010103050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0020001000000000000000000000000000111111111111111211111111121515150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0020000000000000000000000000000011120000121200000000070811110016151500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001000000000130011001300000011111200001200000000171811111213161600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000100000000000000000000012111100000000000000040010111115150000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000011000000000000000200121100000000001300000000121116000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000012002000000000000013002400001200000000000000000000101116000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000030003121212123000000000000000000000000000000001200111115000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001300003221212121212121230013000000000000000000000011111515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1600000000000032222222222222220000000000000000000000130015150015000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1600000000000000322222222222222300000000000000000000000000001615000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1600000000000000000000322222222222230000000000000000000000001615000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000130000000000340000001332222222222300000013000000000000000015000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000322222222223130000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0013000000000000000000130000000000222222222300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000322222223300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000006050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001300000061000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
